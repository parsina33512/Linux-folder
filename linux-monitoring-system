Ù¾Ø±ÙˆÚ˜Ù‡: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ± Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ùˆ Ø¯ÛŒØ¯Ù‡â€ŒØ¨Ø§Ù†ÛŒ Ø¨Ø§ Alerting System
ÙØ§Ø² Û±: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù¾Ø§ÛŒÙ‡ Ùˆ Ù†ØµØ¨ prerequisites
bash
#!/bin/bash

# Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…
echo "=== Ø¨Ù‡ Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³ÛŒØ³ØªÙ… ==="
sudo dnf update -y
sudo dnf upgrade -y

# Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
echo "=== Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ ==="
sudo dnf install -y wget curl tar vim git make gcc openssl-devel \
    bzip2-devel libffi-devel zlib-devel java-11-openjdk python3-pip

# Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§
echo "=== Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ ==="
python3 --version
java --version
git --version
ÙØ§Ø² Û²: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Prometheus Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§
bash
# Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ù…Ø®ØµÙˆØµ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø³Ø±ÙˆÛŒØ³ ==="
sudo useradd -r -s /bin/false prometheus
sudo useradd -r -s /bin/false node_exporter

# Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ ==="
sudo mkdir -p /opt/monitoring/{prometheus,node_exporter,alertmanager,grafana}
sudo mkdir -p /var/lib/prometheus/data
sudo chown -R prometheus:prometheus /var/lib/prometheus
sudo chown -R prometheus:prometheus /opt/monitoring/prometheus

# Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù†ØµØ¨ Prometheus
echo "=== Ù†ØµØ¨ Prometheus ==="
cd /tmp
PROM_VERSION="2.47.0"
wget https://github.com/prometheus/prometheus/releases/download/v${PROM_VERSION}/prometheus-${PROM_VERSION}.linux-amd64.tar.gz
tar xvf prometheus-${PROM_VERSION}.linux-amd64.tar.gz
cd prometheus-${PROM_VERSION}.linux-amd64

# Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ÛŒÙ†Ø±ÛŒ
sudo cp prometheus promtool /usr/local/bin/
sudo cp prometheus promtool /opt/monitoring/prometheus/

# ØªÙ†Ø¸ÛŒÙ… Ù…Ø§Ù„Ú©ÛŒØª
sudo chown prometheus:prometheus /usr/local/bin/prometheus
sudo chown prometheus:prometheus /usr/local/bin/promtool
sudo chown -R prometheus:prometheus /opt/monitoring/prometheus/

# Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Prometheus
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Prometheus ==="
sudo tee /etc/prometheus.yml > /dev/null <<'EOF'
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "/etc/prometheus/rules.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - localhost:9093

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'node_exporter'
    static_configs:
      - targets: ['localhost:9100']

  - job_name: 'web_servers'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: /metrics
    scrape_interval: 10s

  - job_name: 'custom_app'
    static_configs:
      - targets: ['localhost:8000']
EOF

# Ø§ÛŒØ¬Ø§Ø¯ Ù‚ÙˆØ§Ù†ÛŒÙ† Alert
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù‡Ø´Ø¯Ø§Ø± ==="
sudo tee /etc/prometheus/rules.yml > /dev/null <<'EOF'
groups:
- name: node_rules
  rules:
  - alert: HighNodeCPU
    expr: 100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High CPU usage on {{ $labels.instance }}"
      description: "CPU usage is above 80% for more than 5 minutes."

  - alert: HighNodeMemory
    expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High memory usage on {{ $labels.instance }}"
      description: "Memory usage is above 85% for more than 5 minutes."

  - alert: NodeDown
    expr: up == 0
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "Node {{ $labels.instance }} is down"
      description: "Node has been down for more than 2 minutes."
EOF

sudo chown prometheus:prometheus /etc/prometheus.yml
sudo chown prometheus:prometheus /etc/prometheus/rules.yml
ÙØ§Ø² Û³: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Node Exporter
bash
# Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù†ØµØ¨ Node Exporter
echo "=== Ù†ØµØ¨ Node Exporter ==="
cd /tmp
NODE_EXPORTER_VERSION="1.6.1"
wget https://github.com/prometheus/node_exporter/releases/download/v${NODE_EXPORTER_VERSION}/node_exporter-${NODE_EXPORTER_VERSION}.linux-amd64.tar.gz
tar xvf node_exporter-${NODE_EXPORTER_VERSION}.linux-amd64.tar.gz
cd node_exporter-${NODE_EXPORTER_VERSION}.linux-amd64

sudo cp node_exporter /usr/local/bin/
sudo cp node_exporter /opt/monitoring/node_exporter/
sudo chown node_exporter:node_exporter /usr/local/bin/node_exporter
sudo chown -R node_exporter:node_exporter /opt/monitoring/node_exporter/
ÙØ§Ø² Û´: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Alertmanager
bash
# Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù†ØµØ¨ Alertmanager
echo "=== Ù†ØµØ¨ Alertmanager ==="
cd /tmp
ALERTMANAGER_VERSION="0.25.0"
wget https://github.com/prometheus/alertmanager/releases/download/v${ALERTMANAGER_VERSION}/alertmanager-${ALERTMANAGER_VERSION}.linux-amd64.tar.gz
tar xvf alertmanager-${ALERTMANAGER_VERSION}.linux-amd64.tar.gz
cd alertmanager-${ALERTMANAGER_VERSION}.linux-amd64

sudo cp alertmanager amtool /usr/local/bin/
sudo cp alertmanager amtool /opt/monitoring/alertmanager/
sudo chown prometheus:prometheus /usr/local/bin/alertmanager
sudo chown prometheus:prometheus /usr/local/bin/amtool

# Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Alertmanager
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Alertmanager ==="
sudo tee /etc/alertmanager.yml > /dev/null <<'EOF'
global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'admin'
  smtp_auth_password: 'password'

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'

receivers:
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://localhost:5001/'

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'dev', 'instance']
EOF

sudo chown prometheus:prometheus /etc/alertmanager.yml
ÙØ§Ø² Ûµ: Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Systemd
bash
# Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Prometheus
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Systemd Ø¨Ø±Ø§ÛŒ Prometheus ==="
sudo tee /etc/systemd/system/prometheus.service > /dev/null <<'EOF'
[Unit]
Description=Prometheus Time Series Collection and Processing Server
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
    --config.file /etc/prometheus.yml \
    --storage.tsdb.path /var/lib/prometheus/data \
    --web.console.templates=/etc/prometheus/consoles \
    --web.console.libraries=/etc/prometheus/console_libraries \
    --web.listen-address=0.0.0.0:9090 \
    --web.external-url=

ExecReload=/bin/kill -HUP $MAINPID
TimeoutStopSec=20s
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Node Exporter
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Systemd Ø¨Ø±Ø§ÛŒ Node Exporter ==="
sudo tee /etc/systemd/system/node_exporter.service > /dev/null <<'EOF'
[Unit]
Description=Node Exporter
Wants=network-online.target
After=network-online.target

[Service]
User=node_exporter
Group=node_exporter
Type=simple
ExecStart=/usr/local/bin/node_exporter \
    --collector.systemd \
    --collector.processes \
    --collector.tcpstat

[Install]
WantedBy=multi-user.target
EOF

# Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Alertmanager
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Systemd Ø¨Ø±Ø§ÛŒ Alertmanager ==="
sudo tee /etc/systemd/system/alertmanager.service > /dev/null <<'DEVNULL'
[Unit]
Description=Alertmanager Server
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/alertmanager \
    --config.file /etc/alertmanager.yml \
    --storage.path /var/lib/prometheus/alertmanager \
    --web.listen-address=0.0.0.0:9093 \
    --cluster.listen-address=0.0.0.0:9094

ExecReload=/bin/kill -HUP $MAINPID
TimeoutStopSec=20s
Restart=always

[Install]
WantedBy=multi-user.target
DEVNULL
ÙØ§Ø² Û¶: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Grafana
bash
# Ù†ØµØ¨ Grafana
echo "=== Ù†ØµØ¨ Grafana ==="
sudo tee /etc/yum.repos.d/grafana.repo > /dev/null <<'EOF'
[grafana]
name=grafana
baseurl=https://packages.grafana.com/oss/rpm
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://packages.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
EOF

sudo dnf install -y grafana

# Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ ==="
sudo mkdir -p /etc/grafana/provisioning/dashboards
sudo mkdir -p /etc/grafana/provisioning/datasources

# Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø³ÛŒØ³ØªÙ…
sudo tee /etc/grafana/provisioning/dashboards/system.yaml > /dev/null <<'EOF'
apiVersion: 1

providers:
  - name: 'default'
    orgId: 1
    folder: ''
    type: file
    disableDeletion: false
    updateIntervalSeconds: 10
    allowUiUpdates: true
    options:
      path: /var/lib/grafana/dashboards
EOF

# Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù†Ø¨Ø¹ Ø¯Ø§Ø¯Ù‡ Prometheus
sudo tee /etc/grafana/provisioning/datasources/prometheus.yaml > /dev/null <<'EOF'
apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://localhost:9090
    isDefault: true
    editable: true
EOF
ÙØ§Ø² Û·: Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªØ³Øª Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…ØªØ±ÛŒÚ©
bash
# Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Python Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´ÛŒ
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªØ³Øª Ù…ØªØ±ÛŒÚ© ==="
sudo tee /opt/monitoring/custom_metrics/app.py > /dev/null <<'EOF'
from prometheus_client import start_http_server, Counter, Gauge, Histogram
import random
import time
import threading

# ØªØ¹Ø±ÛŒÙ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§
REQUEST_COUNT = Counter('http_requests_total', 'Total HTTP Requests', ['method', 'endpoint'])
REQUEST_DURATION = Histogram('http_request_duration_seconds', 'HTTP request duration in seconds')
ACTIVE_USERS = Gauge('active_users', 'Number of active users')
ERROR_COUNT = Counter('http_errors_total', 'Total HTTP Errors', ['type'])
TEMPERATURE = Gauge('system_temperature_celsius', 'System temperature simulation')

def simulate_requests():
    endpoints = ['/api/v1/users', '/api/v1/products', '/api/v1/orders', '/health']
    methods = ['GET', 'POST', 'PUT', 'DELETE']
    
    while True:
        endpoint = random.choice(endpoints)
        method = random.choice(methods)
        
        # Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª
        with REQUEST_DURATION.time():
            time.sleep(random.uniform(0.01, 0.5))
            
            # Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ (5% Ø´Ø§Ù†Ø³ Ø®Ø·Ø§)
            if random.random() < 0.05:
                ERROR_COUNT.labels(type='500').inc()
            else:
                REQUEST_COUNT.labels(method=method, endpoint=endpoint).inc()

def simulate_users():
    while True:
        users = random.randint(100, 1000)
        ACTIVE_USERS.set(users)
        time.sleep(30)

def simulate_temperature():
    while True:
        temp = random.uniform(40.0, 85.0)
        TEMPERATURE.set(temp)
        time.sleep(10)

if __name__ == '__main__':
    # Ø´Ø±ÙˆØ¹ Ø³Ø±ÙˆØ± Ù…ØªØ±ÛŒÚ© Ø¨Ø± Ø±ÙˆÛŒ Ù¾ÙˆØ±Øª 8000
    start_http_server(8000)
    
    print("Custom metrics server started on port 8000")
    
    # Ø´Ø±ÙˆØ¹ threadÙ‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ
    threading.Thread(target=simulate_requests, daemon=True).start()
    threading.Thread(target=simulate_users, daemon=True).start()
    threading.Thread(target=simulate_temperature, daemon=True).start()
    
    # Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("Stopping metrics server...")
EOF

# Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆÛŒØ³ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…ØªØ±ÛŒÚ©
sudo tee /etc/systemd/system/custom_metrics.service > /dev/null <<'EOF'
[Unit]
Description=Custom Metrics Generator
After=network.target

[Service]
Type=simple
User=prometheus
WorkingDirectory=/opt/monitoring/custom_metrics
ExecStart=/usr/bin/python3 app.py
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Python Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
sudo pip3 install prometheus_client
ÙØ§Ø² Û¸: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ùˆ ØªØ³Øª Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…
bash
# ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø´Ø±ÙˆØ¹ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
echo "=== ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ ==="
sudo systemctl daemon-reload

sudo systemctl enable prometheus node_exporter alertmanager grafana-server custom_metrics
sudo systemctl start prometheus node_exporter alertmanager grafana-server custom_metrics

# Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
echo "=== Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ ==="
sudo systemctl status prometheus --no-pager
sudo systemctl status node_exporter --no-pager  
sudo systemctl status alertmanager --no-pager
sudo systemctl status grafana-server --no-pager
sudo systemctl status custom_metrics --no-pager

# ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ endpointÙ‡Ø§
echo "=== ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ ==="
curl -s http://localhost:9090/metrics | head -10
curl -s http://localhost:9100/metrics | head -10
curl -s http://localhost:8000/metrics | head -10
curl -s http://localhost:9093 | head -5

# Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²
echo "=== Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ ==="
sudo ss -tulpn | grep -E ':(9090|9100|8000|9093|3000)'
ÙØ§Ø² Û¹: Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø³Ù„Ø§Ù…Øª
bash
# Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø³Ù„Ø§Ù…Øª ==="
sudo tee /opt/monitoring/health_check.sh > /dev/null <<'EOF'
#!/bin/bash

echo "=== Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ - Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª ==="
echo "Ø²Ù…Ø§Ù†: $(date)"
echo ""

# Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
services=("prometheus" "node_exporter" "alertmanager" "grafana-server" "custom_metrics")
for service in "${services[@]}"; do
    if systemctl is-active --quiet "$service"; then
        echo "âœ… $service: ÙØ¹Ø§Ù„"
    else
        echo "âŒ $service: ØºÛŒØ±ÙØ¹Ø§Ù„"
    fi
done

echo ""
echo "=== Ø¨Ø±Ø±Ø³ÛŒ endpointÙ‡Ø§ ==="

# Ø¨Ø±Ø±Ø³ÛŒ endpointÙ‡Ø§ÛŒ Ù…ØªØ±ÛŒÚ©
endpoints=("localhost:9090" "localhost:9100" "localhost:8000" "localhost:9093")
for endpoint in "${endpoints[@]}"; do
    if curl -s "http://$endpoint" > /dev/null; then
        echo "âœ… $endpoint: Ø¯Ø± Ø¯Ø³ØªØ±Ø³"
    else
        echo "âŒ $endpoint: ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³"
    fi
done

echo ""
echo "=== Ø¨Ø±Ø±Ø³ÛŒ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ ==="

# Ø¨Ø±Ø±Ø³ÛŒ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù…
if curl -s http://localhost:9090/api/v1/query?query=up 2>/dev/null | grep -q "data"; then
    echo "âœ… Prometheus API: Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯"
else
    echo "âŒ Prometheus API: Ù…Ø´Ú©Ù„ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø·"
fi

# Ø¨Ø±Ø±Ø³ÛŒ uptime Ø³ÛŒØ³ØªÙ…
UPTIME=$(uptime | awk -F'up ' '{print $2}' | awk -F',' '{print $1}')
echo "ðŸ“Š Uptime Ø³ÛŒØ³ØªÙ…: $UPTIME"

# Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² CPU
CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | awk -F'%' '{print $1}')
echo "ðŸ“Š Ø§Ø³ØªÙØ§Ø¯Ù‡ CPU: ${CPU_USAGE}%"

# Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Memory
MEM_USAGE=$(free | grep Mem | awk '{printf "%.1f", $3/$2 * 100.0}')
echo "ðŸ“Š Ø§Ø³ØªÙØ§Ø¯Ù‡ Memory: ${MEM_USAGE}%"

echo ""
echo "=== Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ù„Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ ==="
ALERTS=$(curl -s http://localhost:9090/api/v1/alerts 2>/dev/null | grep -o '"state":"[^"]*"' | grep -v "inactive" | wc -l)
echo "ðŸ”” ØªØ¹Ø¯Ø§Ø¯ Ø¢Ù„Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„: $ALERTS"
EOF

sudo chmod +x /opt/monitoring/health_check.sh
ÙØ§Ø² Û±Û°: Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ÙØ§ÛŒØ±ÙˆØ§Ù„
bash
# Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¯Ø± ÙØ§ÛŒØ±ÙˆØ§Ù„
echo "=== Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ÙØ§ÛŒØ±ÙˆØ§Ù„ ==="
sudo firewall-cmd --permanent --add-port=9090/tcp  # Prometheus
sudo firewall-cmd --permanent --add-port=9100/tcp  # Node Exporter  
sudo firewall-cmd --permanent --add-port=8000/tcp  # Custom Metrics
sudo firewall-cmd --permanent --add-port=9093/tcp  # Alertmanager
sudo firewall-cmd --permanent --add-port=3000/tcp  # Grafana
sudo firewall-cmd --permanent --add-port=8080/tcp  # Web Server (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
sudo firewall-cmd --reload

# Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª ÙØ§ÛŒØ±ÙˆØ§Ù„
sudo firewall-cmd --list-all
ÙØ§Ø² Û±Û±: Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
bash
# Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´ Ù†ØµØ¨
echo "=== Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´ Ù†ØµØ¨ ==="
sudo tee /opt/monitoring/INSTALL_REPORT.md > /dev/null <<'EOF'
# Ú¯Ø²Ø§Ø±Ø´ Ù†ØµØ¨ Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯

## âœ… Ù†ØµØ¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯

## Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯Ù‡:

### 1. Prometheus
- **Ù¾ÙˆØ±Øª**: 9090
- **Ø¯Ø³ØªØ±Ø³ÛŒ**: http://localhost:9090
- **ÙˆØ¸ÛŒÙÙ‡**: Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ùˆ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§

### 2. Node Exporter
- **Ù¾ÙˆØ±Øª**: 9100  
- **Ø¯Ø³ØªØ±Ø³ÛŒ**: http://localhost:9100/metrics
- **ÙˆØ¸ÛŒÙÙ‡**: Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…

### 3. Alertmanager
- **Ù¾ÙˆØ±Øª**: 9093
- **Ø¯Ø³ØªØ±Ø³ÛŒ**: http://localhost:9093
- **ÙˆØ¸ÛŒÙÙ‡**: Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§

### 4. Grafana
- **Ù¾ÙˆØ±Øª**: 3000
- **Ø¯Ø³ØªØ±Ø³ÛŒ**: http://localhost:3000
- **ÙˆØ±ÙˆØ¯ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶**: admin/admin
- **ÙˆØ¸ÛŒÙÙ‡**: Ù†Ù…Ø§ÛŒØ´ Ø¯Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯

### 5. Custom Metrics
- **Ù¾ÙˆØ±Øª**: 8000
- **Ø¯Ø³ØªØ±Ø³ÛŒ**: http://localhost:8000/metrics
- **ÙˆØ¸ÛŒÙÙ‡**: ØªÙˆÙ„ÛŒØ¯ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ùˆ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ

## Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙÛŒØ¯:

### Ø¨Ø±Ø±Ø³ÛŒ Ø³Ù„Ø§Ù…Øª Ø³ÛŒØ³ØªÙ…:
```bash
/opt/monitoring/health_check.sh
Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§:
bash
sudo journalctl -u prometheus -f
sudo journalctl -u node_exporter -f
sudo journalctl -u alertmanager -f
Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§:
bash
sudo systemctl restart prometheus node_exporter alertmanager grafana-server
Ù‚Ø¯Ù… Ø¨Ø¹Ø¯ÛŒ:
Ø¨Ù‡ Grafana Ø¯Ø± Ø¢Ø¯Ø±Ø³ http://localhost:3000 Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯

Ø¨Ø§ admin/admin ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯

Ù…Ù†Ø¨Ø¹ Ø¯Ø§Ø¯Ù‡ Prometheus Ø±Ø§ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØ¯ (http://localhost:9090)

Ø¯Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø±Ø§ import Ú©Ù†ÛŒØ¯
