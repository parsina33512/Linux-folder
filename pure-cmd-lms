sudo dnf update -y

sudo dnf install -y nginx certbot python3-certbot-nginx firewalld curl wget htop

sudo systemctl enable --now nginx firewalld

sudo systemctl status nginx firewalld --no-pager

sudo firewall-cmd --permanent --add-service={http,https,ssh}

sudo firewall-cmd --permanent --add-port=9090/tcp

sudo firewall-cmd --reload

sudo firewall-cmd --list-all

sudo mkdir -p /var/www/example.com/{html,logs,backup}

sudo chown -R nginx:nginx /var/www/example.com

cd /var/www/example.com/html

sudo tee index.html <<'EOF'

sudo tee metrics.html <<'EOF'

sudo tee /etc/nginx/conf.d/example.com.conf <<'EOF'

sudo nginx -t

sudo systemctl reload nginx

cd /tmp

wget https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz

tar xvf node_exporter-1.6.1.linux-amd64.tar.gz

sudo cp node_exporter-1.6.1.linux-amd64/node_exporter /usr/local/bin/

sudo chmod +x /usr/local/bin/node_exporter

sudo useradd -rs /bin/false node_exporter

sudo tee /etc/systemd/system/node_exporter.service <<'EOF'

sudo systemctl daemon-reload

sudo systemctl enable --now node_exporter

sudo firewall-cmd --permanent --add-port=9100/tcp

sudo firewall-cmd --reload

sudo tee /usr/local/bin/health-check <<'EOF'

sudo chmod +x /usr/local/bin/health-check

sudo tee /usr/local/bin/backup-site <<'EOF'

sudo chmod +x /usr/local/bin/backup-site

sudo /usr/local/bin/backup-site

curl -s http://localhost | head -5

curl -s http://localhost:9100/metrics | head -3

health-check
